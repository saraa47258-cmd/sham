<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ù† - Bon Coffee | Ø§Ù„Ù…Ø®Ø²Ù†</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 14px;
            margin-bottom: 18px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 18px 16px;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            inset-inline: 0;
            top: 0;
            height: 4px;
            background: var(--gradient);
            opacity: 0.9;
        }

        .stat-card .icon {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 1.6rem;
            font-weight: 900;
            line-height: 1;
            margin-bottom: 6px;
        }

        .stat-card .label {
            color: var(--text-secondary);
            font-weight: 800;
            font-size: 0.9rem;
        }

        /* Low stock alert */
        .alert-box {
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(239, 68, 68, 0.25);
            border-radius: 16px;
            padding: 14px 14px;
            margin-bottom: 18px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .alert-box i {
            font-size: 1.6rem;
            color: var(--danger);
        }

        .alert-box h4 {
            margin: 0 0 4px 0;
            color: var(--danger);
            font-size: 1rem;
        }

        .alert-box p {
            margin: 0;
            color: var(--text-secondary);
            font-weight: 700;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 18px;
            margin-bottom: 18px;
        }

        .card h3 {
            margin: 0 0 14px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text);
            font-size: 1.05rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: var(--text-secondary);
            font-weight: 800;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 14px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            font-family: inherit;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        .form-actions .btn { flex: 1; }

        /* Filters */
        .filter-bar {
            display: grid;
            grid-template-columns: 220px 200px 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        /* Inventory table */
        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            overflow: hidden;
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .inventory-table th,
        .inventory-table td {
            padding: 12px 10px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .inventory-table th {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-weight: 900;
            font-size: 0.9rem;
            text-align: right;
        }

        .inventory-table tr:hover td {
            background: rgba(255, 255, 255, 0.03);
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item-icon {
            width: 38px;
            height: 38px;
            border-radius: 14px;
            background: var(--bg);
            border: 1px solid var(--border);
            display: grid;
            place-items: center;
            font-size: 1.25rem;
        }

        .item-details h4 {
            margin: 0;
            font-size: 0.98rem;
        }

        .item-details p {
            margin: 2px 0 0 0;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 700;
        }

        .quantity-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            font-weight: 900;
        }

        .quantity-display .unit {
            color: var(--text-secondary);
            font-weight: 800;
            font-size: 0.85rem;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 999px;
            padding: 6px 10px;
            font-weight: 900;
            font-size: 0.85rem;
            border: 1px solid var(--border);
        }

        .status-badge.ok { color: var(--success); background: rgba(34, 197, 94, 0.12); border-color: rgba(34, 197, 94, 0.25); }
        .status-badge.low { color: var(--warning); background: rgba(245, 158, 11, 0.12); border-color: rgba(245, 158, 11, 0.25); }
        .status-badge.expiring { color: var(--danger); background: rgba(239, 68, 68, 0.10); border-color: rgba(239, 68, 68, 0.25); }

        .action-btns {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 38px;
            height: 38px;
            border-radius: 14px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            cursor: pointer;
        }

        .icon-btn:hover { border-color: var(--primary); }

        .icon-btn.danger { color: #fff; background: rgba(239, 68, 68, 0.22); border-color: rgba(239, 68, 68, 0.35); }

        .empty-state {
            text-align: center;
            padding: 28px 10px;
            color: var(--text-secondary);
        }

        .empty-state i { font-size: 2.2rem; margin-bottom: 10px; color: var(--text-secondary); }

        @media (max-width: 1100px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .form-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
            .filter-bar { grid-template-columns: 1fr; }
            .inventory-table th,
            .inventory-table td { padding: 10px 8px; }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar"></aside>

    <main class="main-content">
        <header class="header">
            <div class="header-title">
                <h2>ğŸ“¦ Ø§Ù„Ù…Ø®Ø²Ù†</h2>
                <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ù†Ø¸Ø§Ù… full-system Ø¯Ø§Ø®Ù„ Bon)</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="BonApp.toggleTheme()">
                    <i class="fas fa-moon"></i>
                    ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø±
                </button>
            </div>
        </header>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="icon"><i class="fas fa-boxes"></i></div>
                <div class="value" id="inv-total">0</div>
                <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="value" id="inv-low">0</div>
                <div class="label">Ù†Ù‚Øµ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fas fa-clock"></i></div>
                <div class="value" id="inv-expiring">0</div>
                <div class="label">Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (7 Ø£ÙŠØ§Ù…)</div>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fas fa-coins"></i></div>
                <div class="value" id="inv-value">0.000</div>
                <div class="label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (${''}Ø±.Ø¹)</div>
            </div>
        </div>

        <!-- Low stock alert -->
        <div class="alert-box" id="low-stock-alert" style="display:none;">
            <i class="fas fa-exclamation-circle"></i>
            <div>
                <h4>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ù†Ù‚Øµ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†!</h4>
                <p id="low-stock-items">Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ ÙˆØªØ­ØªØ§Ø¬ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹Ø¨Ø¦Ø©</p>
            </div>
        </div>

        <!-- Add / Edit item (ported) -->
        <div class="card">
            <h3><i class="fas fa-plus-circle" style="color: var(--primary);"></i> Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù…Ø§Ø¯Ø©</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label><i class="fas fa-tag"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="inv-name" placeholder="Ù…Ø«Ø§Ù„: Ø­Ù„ÙŠØ¨ Ø·Ø§Ø²Ø¬">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-folder"></i> Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                    <select id="inv-category">
                        <option value="vegetables">ğŸ¥¬ Ø®Ø¶Ø±ÙˆØ§Øª</option>
                        <option value="fruits">ğŸ ÙÙˆØ§ÙƒÙ‡</option>
                        <option value="meat">ğŸ¥© Ù„Ø­ÙˆÙ…</option>
                        <option value="poultry">ğŸ— Ø¯ÙˆØ§Ø¬Ù†</option>
                        <option value="seafood">ğŸŸ Ù…Ø£ÙƒÙˆÙ„Ø§Øª Ø¨Ø­Ø±ÙŠØ©</option>
                        <option value="dairy">ğŸ§€ Ø£Ù„Ø¨Ø§Ù† ÙˆØ£Ø¬Ø¨Ø§Ù†</option>
                        <option value="grains">ğŸŒ¾ Ø­Ø¨ÙˆØ¨ ÙˆØ±Ø²</option>
                        <option value="spices">ğŸŒ¶ï¸ Ø¨Ù‡Ø§Ø±Ø§Øª ÙˆØªÙˆØ§Ø¨Ù„</option>
                        <option value="oils">ğŸ«’ Ø²ÙŠÙˆØª ÙˆØ³Ù…Ù†</option>
                        <option value="drinks">ğŸ¥¤ Ù…Ø´Ø±ÙˆØ¨Ø§Øª</option>
                        <option value="frozen">ğŸ§Š Ù…Ø¬Ù…Ø¯Ø§Øª</option>
                        <option value="canned">ğŸ¥« Ù…Ø¹Ù„Ø¨Ø§Øª</option>
                        <option value="bakery">ğŸ Ù…Ø®Ø¨ÙˆØ²Ø§Øª</option>
                        <option value="other">ğŸ“¦ Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-cubes"></i> Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                    <input type="number" id="inv-quantity" min="0" step="0.1" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-balance-scale"></i> Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                    <select id="inv-unit">
                        <option value="kg">ÙƒÙŠÙ„ÙˆØ¬Ø±Ø§Ù… (kg)</option>
                        <option value="g">Ø¬Ø±Ø§Ù… (g)</option>
                        <option value="L">Ù„ØªØ± (L)</option>
                        <option value="ml">Ù…Ù„ÙŠÙ„ØªØ± (ml)</option>
                        <option value="pcs">Ù‚Ø·Ø¹Ø©</option>
                        <option value="box">ØµÙ†Ø¯ÙˆÙ‚</option>
                        <option value="bag">ÙƒÙŠØ³</option>
                        <option value="pack">Ø¹Ø¨ÙˆØ©</option>
                        <option value="dozen">Ø¯Ø±Ø²Ù†</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-exclamation"></i> Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ (ØªÙ†Ø¨ÙŠÙ‡)</label>
                    <input type="number" id="inv-min" min="0" step="0.1" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-money-bill"></i> Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (Ø±.Ø¹)</label>
                    <input type="number" id="inv-price" min="0" step="0.001" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</label>
                    <input type="date" id="inv-expiry">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-truck"></i> Ø§Ù„Ù…ÙˆØ±Ø¯</label>
                    <input type="text" id="inv-supplier" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                    <input type="text" id="inv-notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©">
                </div>
            </div>
            <input type="hidden" id="edit-inv-id">
            <div class="form-actions">
                <button class="btn btn-success" onclick="saveInventoryItem()">
                    <i class="fas fa-save"></i> <span id="inv-save-btn-text">Ø­ÙØ¸ Ø§Ù„Ù…Ø§Ø¯Ø©</span>
                </button>
                <button class="btn btn-secondary" onclick="clearInventoryForm()">
                    <i class="fas fa-eraser"></i> Ù…Ø³Ø­
                </button>
            </div>
        </div>

        <!-- Inventory list (ported) -->
        <div class="card">
            <h3><i class="fas fa-warehouse" style="color: var(--gold);"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (<span id="inv-count">0</span> ØµÙ†Ù)</h3>
            <div class="filter-bar">
                <select id="inv-filter-category" onchange="loadInventoryList()">
                    <option value="all">ğŸ·ï¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
                    <option value="vegetables">ğŸ¥¬ Ø®Ø¶Ø±ÙˆØ§Øª</option>
                    <option value="fruits">ğŸ ÙÙˆØ§ÙƒÙ‡</option>
                    <option value="meat">ğŸ¥© Ù„Ø­ÙˆÙ…</option>
                    <option value="poultry">ğŸ— Ø¯ÙˆØ§Ø¬Ù†</option>
                    <option value="seafood">ğŸŸ Ù…Ø£ÙƒÙˆÙ„Ø§Øª Ø¨Ø­Ø±ÙŠØ©</option>
                    <option value="dairy">ğŸ§€ Ø£Ù„Ø¨Ø§Ù† ÙˆØ£Ø¬Ø¨Ø§Ù†</option>
                    <option value="grains">ğŸŒ¾ Ø­Ø¨ÙˆØ¨ ÙˆØ±Ø²</option>
                    <option value="spices">ğŸŒ¶ï¸ Ø¨Ù‡Ø§Ø±Ø§Øª ÙˆØªÙˆØ§Ø¨Ù„</option>
                    <option value="oils">ğŸ«’ Ø²ÙŠÙˆØª ÙˆØ³Ù…Ù†</option>
                    <option value="drinks">ğŸ¥¤ Ù…Ø´Ø±ÙˆØ¨Ø§Øª</option>
                    <option value="frozen">ğŸ§Š Ù…Ø¬Ù…Ø¯Ø§Øª</option>
                    <option value="canned">ğŸ¥« Ù…Ø¹Ù„Ø¨Ø§Øª</option>
                    <option value="bakery">ğŸ Ù…Ø®Ø¨ÙˆØ²Ø§Øª</option>
                    <option value="other">ğŸ“¦ Ø£Ø®Ø±Ù‰</option>
                </select>
                <select id="inv-filter-status" onchange="loadInventoryList()">
                    <option value="all">ğŸ“Š Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                    <option value="ok">âœ… Ù…ØªÙˆÙØ±</option>
                    <option value="low">âš ï¸ Ù†Ù‚Øµ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</option>
                    <option value="expiring">â° Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</option>
                </select>
                <input type="text" id="inv-search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ø§Ø¯Ø©..." oninput="loadInventoryList()">
            </div>
            <div id="inventory-list"></div>
        </div>
    </main>

    <div class="toast-container"></div>

    <script src="js/app.js"></script>
    <script>
        // ===== full-system inventory logic adapted to Bon =====
        const categoryIcons = {
            vegetables: 'ğŸ¥¬', fruits: 'ğŸ', meat: 'ğŸ¥©', poultry: 'ğŸ—',
            seafood: 'ğŸŸ', dairy: 'ğŸ§€', grains: 'ğŸŒ¾', spices: 'ğŸŒ¶ï¸',
            oils: 'ğŸ«’', drinks: 'ğŸ¥¤', frozen: 'ğŸ§Š', canned: 'ğŸ¥«',
            bakery: 'ğŸ', other: 'ğŸ“¦'
        };

        const categoryNames = {
            vegetables: 'Ø®Ø¶Ø±ÙˆØ§Øª', fruits: 'ÙÙˆØ§ÙƒÙ‡', meat: 'Ù„Ø­ÙˆÙ…', poultry: 'Ø¯ÙˆØ§Ø¬Ù†',
            seafood: 'Ù…Ø£ÙƒÙˆÙ„Ø§Øª Ø¨Ø­Ø±ÙŠØ©', dairy: 'Ø£Ù„Ø¨Ø§Ù† ÙˆØ£Ø¬Ø¨Ø§Ù†', grains: 'Ø­Ø¨ÙˆØ¨ ÙˆØ±Ø²',
            spices: 'Ø¨Ù‡Ø§Ø±Ø§Øª ÙˆØªÙˆØ§Ø¨Ù„', oils: 'Ø²ÙŠÙˆØª ÙˆØ³Ù…Ù†', drinks: 'Ù…Ø´Ø±ÙˆØ¨Ø§Øª',
            frozen: 'Ù…Ø¬Ù…Ø¯Ø§Øª', canned: 'Ù…Ø¹Ù„Ø¨Ø§Øª', bakery: 'Ù…Ø®Ø¨ÙˆØ²Ø§Øª', other: 'Ø£Ø®Ø±Ù‰'
        };

        const unitNames = {
            kg: 'ÙƒÙŠÙ„Ùˆ', g: 'Ø¬Ø±Ø§Ù…', L: 'Ù„ØªØ±', ml: 'Ù…Ù„',
            pcs: 'Ù‚Ø·Ø¹Ø©', box: 'ØµÙ†Ø¯ÙˆÙ‚', bag: 'ÙƒÙŠØ³', pack: 'Ø¹Ø¨ÙˆØ©', dozen: 'Ø¯Ø±Ø²Ù†'
        };

        function getMin(item) {
            return Number(item?.minStock ?? item?.minQuantity ?? 0);
        }

        function getCategory(item) {
            return (item?.category || 'other');
        }

        function getInventory() {
            return Array.isArray(BonApp?.state?.inventory) ? BonApp.state.inventory : [];
        }

        function setInventory(items) {
            BonApp.state.inventory = Array.isArray(items) ? items : [];
            BonApp.saveData();
        }

        function loadInventoryStats() {
            const inventory = getInventory();
            const now = new Date();
            const weekLater = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);

            const total = inventory.length;
            const low = inventory.filter(item => Number(item.quantity || 0) <= getMin(item)).length;
            const expiring = inventory.filter(item => {
                if (!item.expiryDate) return false;
                const expiry = new Date(item.expiryDate);
                return expiry <= weekLater && expiry >= now;
            }).length;
            const value = inventory.reduce((sum, item) => sum + (Number(item.quantity || 0) * Number(item.price || 0)), 0);

            document.getElementById('inv-total').textContent = total;
            document.getElementById('inv-low').textContent = low;
            document.getElementById('inv-expiring').textContent = expiring;
            document.getElementById('inv-value').textContent = value.toFixed(3);

            const alertEl = document.getElementById('low-stock-alert');
            if (low > 0) {
                const lowItems = inventory
                    .filter(item => Number(item.quantity || 0) <= getMin(item))
                    .map(item => item.name)
                    .slice(0, 3);
                document.getElementById('low-stock-items').textContent =
                    'Ø§Ù„Ù…ÙˆØ§Ø¯: ' + lowItems.join('ØŒ ') + (low > 3 ? ` Ùˆ ${low - 3} Ø£Ø®Ø±Ù‰` : '');
                alertEl.style.display = 'flex';
            } else {
                alertEl.style.display = 'none';
            }
        }

        function loadInventoryList() {
            const categoryFilter = document.getElementById('inv-filter-category').value;
            const statusFilter = document.getElementById('inv-filter-status').value;
            const searchQuery = (document.getElementById('inv-search').value || '').toLowerCase();

            let inventory = getInventory();
            const now = new Date();
            const weekLater = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);

            if (categoryFilter !== 'all') {
                inventory = inventory.filter(item => getCategory(item) === categoryFilter);
            }

            if (statusFilter !== 'all') {
                inventory = inventory.filter(item => {
                    const qty = Number(item.quantity || 0);
                    const minQ = getMin(item);
                    const isLow = qty <= minQ;
                    const isExpiring = item.expiryDate && new Date(item.expiryDate) <= weekLater && new Date(item.expiryDate) >= now;
                    if (statusFilter === 'low') return isLow;
                    if (statusFilter === 'expiring') return isExpiring;
                    if (statusFilter === 'ok') return !isLow;
                    return true;
                });
            }

            if (searchQuery) {
                inventory = inventory.filter(item =>
                    (item.name || '').toLowerCase().includes(searchQuery) ||
                    (item.supplier || '').toLowerCase().includes(searchQuery) ||
                    (item.notes || '').toLowerCase().includes(searchQuery)
                );
            }

            document.getElementById('inv-count').textContent = getInventory().length;
            const container = document.getElementById('inventory-list');

            if (!inventory.length) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <h4 style="margin: 0 0 6px 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ù…Ø·Ø§Ø¨Ù‚Ø©</h4>
                        <p style="margin: 0;">Ø¬Ø±Ù‘Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ± Ø£Ùˆ Ø£Ø¶Ù Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <table class="inventory-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            inventory.forEach(item => {
                const qty = Number(item.quantity || 0);
                const minQ = getMin(item);
                const isLow = qty <= minQ;
                const isExpiring = item.expiryDate && new Date(item.expiryDate) <= weekLater && new Date(item.expiryDate) >= now;

                let statusClass = 'ok';
                let statusText = 'Ù…ØªÙˆÙØ± âœ“';
                if (isLow) { statusClass = 'low'; statusText = 'Ù†Ù‚Øµ âš ï¸'; }
                else if (isExpiring) { statusClass = 'expiring'; statusText = 'Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ â°'; }

                const category = getCategory(item);
                const expiryText = item.expiryDate ? new Date(item.expiryDate).toLocaleDateString('ar-OM') : '-';
                const priceText = item.price ? BonApp.formatPrice(Number(item.price || 0)) : '-';
                const unitText = unitNames[item.unit] || item.unit || '';

                html += `
                    <tr>
                        <td>
                            <div class="item-info">
                                <div class="item-icon">${categoryIcons[category] || 'ğŸ“¦'}</div>
                                <div class="item-details">
                                    <h4>${item.name || ''}</h4>
                                    <p>${categoryNames[category] || category}${item.supplier ? ' â€¢ ' + item.supplier : ''}</p>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="quantity-display">
                                <span class="qty">${qty}</span>
                                <span class="unit">${unitText}</span>
                            </div>
                        </td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${expiryText}</td>
                        <td>${priceText}</td>
                        <td>
                            <div class="action-btns">
                                <button class="icon-btn" onclick="addStock(${item.id})" title="Ø¥Ø¶Ø§ÙØ© ÙƒÙ…ÙŠØ©">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button class="icon-btn" onclick="editInventoryItem(${item.id})" title="ØªØ¹Ø¯ÙŠÙ„">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="icon-btn danger" onclick="deleteInventoryItem(${item.id})" title="Ø­Ø°Ù">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function saveInventoryItem() {
            const editId = document.getElementById('edit-inv-id').value;
            const name = document.getElementById('inv-name').value.trim();
            const category = document.getElementById('inv-category').value;
            const quantity = parseFloat(document.getElementById('inv-quantity').value) || 0;
            const unit = document.getElementById('inv-unit').value;
            const minQuantity = parseFloat(document.getElementById('inv-min').value) || 0;
            const price = parseFloat(document.getElementById('inv-price').value) || 0;
            const expiryDate = document.getElementById('inv-expiry').value;
            const supplier = document.getElementById('inv-supplier').value.trim();
            const notes = document.getElementById('inv-notes').value.trim();

            if (!name) {
                BonApp.showToast('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©', 'error');
                return;
            }

            let inventory = getInventory();

            if (editId) {
                const idx = inventory.findIndex(item => item.id === parseInt(editId));
                if (idx !== -1) {
                    inventory[idx] = {
                        ...inventory[idx],
                        name,
                        category,
                        quantity,
                        unit,
                        minStock: minQuantity,
                        minQuantity,
                        price,
                        expiryDate,
                        supplier,
                        notes
                    };
                }
                BonApp.showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } else {
                const newItem = {
                    id: Date.now(),
                    name,
                    category,
                    quantity,
                    unit,
                    minStock: minQuantity,
                    minQuantity,
                    price,
                    expiryDate,
                    supplier,
                    notes,
                    createdAt: new Date().toISOString()
                };
                inventory.push(newItem);
                BonApp.showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }

            setInventory(inventory);
            clearInventoryForm();
            loadInventoryList();
            loadInventoryStats();
        }

        function editInventoryItem(id) {
            const inventory = getInventory();
            const item = inventory.find(i => i.id === id);
            if (!item) return;

            document.getElementById('edit-inv-id').value = item.id;
            document.getElementById('inv-name').value = item.name || '';
            document.getElementById('inv-category').value = getCategory(item);
            document.getElementById('inv-quantity').value = Number(item.quantity || 0);
            document.getElementById('inv-unit').value = item.unit || 'kg';
            document.getElementById('inv-min').value = getMin(item) || '';
            document.getElementById('inv-price').value = item.price || '';
            document.getElementById('inv-expiry').value = item.expiryDate || '';
            document.getElementById('inv-supplier').value = item.supplier || '';
            document.getElementById('inv-notes').value = item.notes || '';
            document.getElementById('inv-save-btn-text').textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø§Ø¯Ø©';

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteInventoryItem(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†ØŸ')) return;
            let inventory = getInventory();
            inventory = inventory.filter(item => item.id !== id);
            setInventory(inventory);
            loadInventoryList();
            loadInventoryStats();
            BonApp.showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø©', 'success');
        }

        function addStock(id) {
            const amount = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¶Ø§ÙØ©:');
            if (!amount || isNaN(parseFloat(amount))) return;

            let inventory = getInventory();
            const idx = inventory.findIndex(item => item.id === id);
            if (idx !== -1) {
                inventory[idx].quantity = Number(inventory[idx].quantity || 0) + parseFloat(amount);
                setInventory(inventory);
                loadInventoryList();
                loadInventoryStats();
                BonApp.showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ…ÙŠØ©', 'success');
            }
        }

        function clearInventoryForm() {
            document.getElementById('edit-inv-id').value = '';
            document.getElementById('inv-name').value = '';
            document.getElementById('inv-category').value = 'vegetables';
            document.getElementById('inv-quantity').value = '';
            document.getElementById('inv-unit').value = 'kg';
            document.getElementById('inv-min').value = '';
            document.getElementById('inv-price').value = '';
            document.getElementById('inv-expiry').value = '';
            document.getElementById('inv-supplier').value = '';
            document.getElementById('inv-notes').value = '';
            document.getElementById('inv-save-btn-text').textContent = 'Ø­ÙØ¸ Ø§Ù„Ù…Ø§Ø¯Ø©';
        }

        document.addEventListener('DOMContentLoaded', () => {
            // BonApp initializes on DOMContentLoaded; run after it.
            setTimeout(() => {
                if (!window.BonApp) return;
                loadInventoryStats();
                loadInventoryList();
            }, 0);
        });
    </script>
    <script src="js/sidebar.js?v=1.1"></script>
</body>
</html>
